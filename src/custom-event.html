<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const saleOffices = {}; //发布者
      saleOffices.clientList = {}; //订阅者清单

      //添加订阅
      saleOffices.$add = function (key, fn) {
        // console.log('$add this:', this);
        // console.log('$add key', key);
        // console.log('$add fn', fn);
        if (!this.clientList[key]) {
          this.clientList[key] = [];
        }
        this.clientList[key].push(fn);
      };

      // 发布订阅
      saleOffices.$publish = function () {
        console.log('$publish this:', this);
        console.log('$publish arguments', arguments);
        const argsTotal = [...arguments];
        const key = argsTotal[0];
        const args = argsTotal.slice(1);
        console.log('$publish key', key);
        console.log('$publish args:', args);
        const clientFns = this.clientList[key];
        console.log('$publish clientFns:', clientFns);
        for (let index = 0; index < clientFns.length; index++) {
          const fn = clientFns[index];
          fn.apply(this, [...args]);
        }
      };

      // 订阅
      saleOffices.$add('add', function (x, y) {
        console.log('this', this);
        console.log('$on1 x:', x);
        console.log('$on1 y:', y);
        console.log('add结果:', x + y);
      });
      saleOffices.$add('multiply', function (x, y) {
        console.log('this', this);
        console.log('$on1 x:', x);
        console.log('$on1 y:', y);
        console.log('multiply结果:', x * y);
      });
      // 发布
      console.log('------------------------------------');
      saleOffices.$publish('add', 1, 2);
      console.log('------------------------------------');
      saleOffices.$publish('multiply', 5, 6);
    </script>
  </body>
</html>
